<html lang="it" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortfolioAI - Gestione Portafoglio Intelligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
    tailwind.config = {
        theme: {
            extend: {
                borderRadius: {
                    lg: "var(--radius)",
                    md: "calc(var(--radius) - 2px)",
                    sm: "calc(var(--radius) - 4px)",
                },
                colors: {
                    background: "var(--background)",
                    foreground: "var(--foreground)",
                    card: {
                        DEFAULT: "var(--card)",
                        foreground: "var(--card-foreground)",
                    },
                    popover: {
                        DEFAULT: "var(--popover)",
                        foreground: "var(--popover-foreground)",
                    },
                    primary: {
                        DEFAULT: "var(--primary)",
                        foreground: "var(--primary-foreground)",
                    },
                    secondary: {
                        DEFAULT: "var(--secondary)",
                        foreground: "var(--secondary-foreground)",
                    },
                    muted: {
                        DEFAULT: "var(--muted)",
                        foreground: "var(--muted-foreground)",
                    },
                    accent: {
                        DEFAULT: "var(--accent)",
                        foreground: "var(--accent-foreground)",
                    },
                    destructive: {
                        DEFAULT: "var(--destructive)",
                        foreground: "var(--destructive-foreground)",
                    },
                    border: "var(--border)",
                    input: "var(--input)",
                    ring: "var(--ring)",
                    success: {
                        DEFAULT: "var(--success)",
                        foreground: "var(--success-foreground)",
                    }
                },
                fontFamily: {
                    sans: ["var(--font-sans)"],
                }
            },
        }
    };
    </script>
    <style>
        :root {
            --background: hsl(210 40% 98%);
            --foreground: hsl(222.2 84% 4.9%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(222.2 84% 4.9%);
            --popover: hsl(0 0% 100%);
            --popover-foreground: hsl(222.2 84% 4.9%);
            --primary: hsl(214 100% 50%);
            --primary-foreground: hsl(210 40% 98%);
            --secondary: hsl(210 40% 96%);
            --secondary-foreground: hsl(222.2 84% 4.9%);
            --muted: hsl(210 40% 96%);
            --muted-foreground: hsl(215.4 16.3% 46.9%);
            --accent: hsl(210 40% 96%);
            --accent-foreground: hsl(222.2 84% 4.9%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(210 40% 98%);
            --success: hsl(142 71% 45%);
            --success-foreground: hsl(355.7 100% 97.3%);
            --border: hsl(214.3 31.8% 91.4%);
            --input: hsl(214.3 31.8% 91.4%);
            --ring: hsl(214 100% 50%);
            --radius: 0.5rem;
            --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .price-update {
            transition: all 0.3s ease;
        }

        .price-positive {
            color: hsl(142 71% 45%);
        }

        .price-negative {
            color: hsl(0 84.2% 60.2%);
        }

        @media (max-width: 768px) {
            .mobile-card {
                margin: 0.5rem;
            }
        }
    </style>
</head>
<body class="min-h-full bg-background text-foreground">
    <!-- @COMPONENT: AppHeader -->
    <header class="bg-card border-b border-border shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="flex items-center justify-center w-8 h-8 bg-primary rounded-lg">
                        <i class="fas fa-chart-line text-primary-foreground text-lg"></i>
                    </div>
                    <h1 class="text-xl font-bold text-foreground">PortfolioAI</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden sm:flex items-center space-x-2 text-sm text-muted-foreground">
                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        <span>Prezzi aggiornati</span>
                        <span data-bind="lastUpdate">14:32</span>
                    </div>
                    <button class="p-2 rounded-lg hover:bg-secondary transition-colors">
                        <i class="fas fa-user-circle text-muted-foreground text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    <!-- @END_COMPONENT: AppHeader -->

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- @COMPONENT: PortfolioOverview -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2">
                <div class="bg-card rounded-lg border border-border p-6 shadow-sm">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-foreground">Il Mio Portafoglio</h2>
                            <p class="text-muted-foreground">Ultimo aggiornamento: <span data-bind="portfolio.lastUpdate">oggi alle 14:32</span></p>
                        </div>
                        <div class="mt-4 sm:mt-0 text-right">
                            <div class="text-3xl font-bold text-foreground" data-bind="portfolio.totalValue">€47.830,25</div>
                            <div class="flex items-center justify-end space-x-2 mt-1">
                                <i class="fas fa-arrow-up text-success text-sm"></i>
                                <span class="text-success font-medium" data-bind="portfolio.totalGain">+€2.150,30 (+4.70%)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-secondary rounded-lg">
                            <div class="text-sm text-muted-foreground mb-1">Azioni</div>
                            <div class="font-semibold text-foreground" data-bind="allocation.stocks">65%</div>
                        </div>
                        <div class="text-center p-4 bg-secondary rounded-lg">
                            <div class="text-sm text-muted-foreground mb-1">ETF</div>
                            <div class="font-semibold text-foreground" data-bind="allocation.etfs">25%</div>
                        </div>
                        <div class="text-center p-4 bg-secondary rounded-lg">
                            <div class="text-sm text-muted-foreground mb-1">Crypto</div>
                            <div class="font-semibold text-foreground" data-bind="allocation.crypto">7%</div>
                        </div>
                        <div class="text-center p-4 bg-secondary rounded-lg">
                            <div class="text-sm text-muted-foreground mb-1">Obbligazioni</div>
                            <div class="font-semibold text-foreground" data-bind="allocation.bonds">3%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-card rounded-lg border border-border p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-foreground mb-4">Asset Allocation</h3>
                <div class="relative">
                    <canvas id="allocationChart" width="200" height="200"></canvas>
                </div>
                <div class="mt-4 space-y-2">
                    <!-- @MAP: allocationData.map(item => ( -->
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-primary rounded-full" data-mock="true"></div>
                            <span class="text-foreground" data-mock="true">AAPL</span>
                        </div>
                        <span class="font-medium text-muted-foreground" data-mock="true">15.2%</span>
                    </div>
                    <!-- @END_MAP )) -->
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: PortfolioOverview -->

        <!-- @COMPONENT: ActionButtons -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <button 
                class="flex-1 bg-primary text-primary-foreground px-6 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center space-x-2"
                data-event="click:openAddInstrumentModal"
                data-implementation="Should open modal for adding new financial instruments">
                <i class="fas fa-plus"></i>
                <span>Aggiungi Strumento</span>
            </button>
            <button 
                class="flex-1 bg-accent text-accent-foreground border border-border px-6 py-3 rounded-lg font-medium hover:bg-accent/80 transition-colors flex items-center justify-center space-x-2"
                data-event="click:triggerAIAnalysis"
                data-implementation="Should trigger AI portfolio analysis and reallocation suggestions">
                <i class="fas fa-brain"></i>
                <span>AI Ri-allocator</span>
            </button>
        </div>
        <!-- @END_COMPONENT: ActionButtons -->

        <!-- @COMPONENT: InstrumentsList -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-foreground mb-6">I Tuoi Strumenti</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                
                <!-- @MAP: instruments.map(instrument => ( -->
                <div class="bg-card rounded-lg border border-border p-6 shadow-sm hover:shadow-md transition-shadow mobile-card" data-mock="true">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-line text-primary"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-foreground" data-bind="instrument.name">Apple Inc.</h4>
                                <p class="text-sm text-muted-foreground" data-bind="instrument.ticker">AAPL</p>
                            </div>
                        </div>
                        <button class="p-2 hover:bg-secondary rounded-lg transition-colors">
                            <i class="fas fa-ellipsis-h text-muted-foreground"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Prezzo Attuale</span>
                            <div class="text-right">
                                <div class="font-semibold text-foreground price-update" data-bind="instrument.currentPrice">$178.25</div>
                                <div class="text-xs price-positive flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span data-bind="instrument.priceChange">+2.15%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Investito</span>
                            <span class="font-semibold text-foreground" data-bind="instrument.investedAmount">€7.250,00</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Valore Attuale</span>
                            <span class="font-semibold text-foreground" data-bind="instrument.currentValue">€7.405,50</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">P&L</span>
                            <span class="font-semibold price-positive" data-bind="instrument.profitLoss">+€155,50 (+2.15%)</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-border">
                        <div class="flex items-center justify-between text-xs text-muted-foreground">
                            <span>Ultimo aggiorn.</span>
                            <span data-bind="instrument.lastUpdate">14:32</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-card rounded-lg border border-border p-6 shadow-sm hover:shadow-md transition-shadow mobile-card" data-mock="true">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-accent/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-coins text-accent-foreground"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-foreground">Vanguard S&P 500</h4>
                                <p class="text-sm text-muted-foreground">VOO</p>
                            </div>
                        </div>
                        <button class="p-2 hover:bg-secondary rounded-lg transition-colors">
                            <i class="fas fa-ellipsis-h text-muted-foreground"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Prezzo Attuale</span>
                            <div class="text-right">
                                <div class="font-semibold text-foreground price-update">$425.80</div>
                                <div class="text-xs price-positive flex items-center">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>+1.85%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Investito</span>
                            <span class="font-semibold text-foreground">€12.000,00</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Valore Attuale</span>
                            <span class="font-semibold text-foreground">€12.620,30</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">P&L</span>
                            <span class="font-semibold price-positive">+€620,30 (+5.17%)</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-border">
                        <div class="flex items-center justify-between text-xs text-muted-foreground">
                            <span>Ultimo aggiorn.</span>
                            <span>14:32</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-card rounded-lg border border-border p-6 shadow-sm hover:shadow-md transition-shadow mobile-card" data-mock="true">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fab fa-bitcoin text-yellow-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-foreground">Bitcoin</h4>
                                <p class="text-sm text-muted-foreground">BTC</p>
                            </div>
                        </div>
                        <button class="p-2 hover:bg-secondary rounded-lg transition-colors">
                            <i class="fas fa-ellipsis-h text-muted-foreground"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Prezzo Attuale</span>
                            <div class="text-right">
                                <div class="font-semibold text-foreground price-update">$43,250.00</div>
                                <div class="text-xs price-negative flex items-center">
                                    <i class="fas fa-arrow-down mr-1"></i>
                                    <span>-3.25%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Investito</span>
                            <span class="font-semibold text-foreground">€3.500,00</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">Valore Attuale</span>
                            <span class="font-semibold text-foreground">€3.265,75</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-muted-foreground">P&L</span>
                            <span class="font-semibold price-negative">-€234,25 (-6.69%)</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-border">
                        <div class="flex items-center justify-between text-xs text-muted-foreground">
                            <span>Ultimo aggiorn.</span>
                            <span>14:31</span>
                        </div>
                    </div>
                </div>
                <!-- @END_MAP )) -->
                
            </div>
        </div>
        <!-- @END_COMPONENT: InstrumentsList -->

        <!-- @COMPONENT: AIRecommendations -->
        <div class="bg-card rounded-lg border border-border p-6 shadow-sm mb-8" id="aiRecommendations" style="display: none;">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                    <i class="fas fa-brain text-primary"></i>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-foreground">Analisi AI del Portafoglio</h3>
                    <p class="text-sm text-muted-foreground">Raccomandazioni basate sull'analisi del mercato attuale</p>
                </div>
            </div>

            <!-- @STATE: analysisLoading:boolean = false -->
            <div id="analysisLoading" class="text-center py-8" style="display: none;">
                <div class="animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
                <p class="text-muted-foreground">Analizzando il tuo portafoglio...</p>
            </div>

            <div id="analysisResults">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h4 class="font-semibold text-foreground mb-4">Scenari di Mercato</h4>
                        <div class="space-y-3">
                            <!-- @MAP: scenarios.map(scenario => ( -->
                            <div class="bg-secondary rounded-lg p-4" data-mock="true">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded font-medium">Breve Termine</span>
                                </div>
                                <p class="text-sm text-foreground">Volatilità moderata attesa nei prossimi 3 mesi con focus su settori tecnologici defensivi.</p>
                            </div>
                            
                            <div class="bg-secondary rounded-lg p-4" data-mock="true">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="px-2 py-1 bg-accent text-accent-foreground text-xs rounded font-medium">Medio Termine</span>
                                </div>
                                <p class="text-sm text-foreground">Consolidamento previsto con opportunità nei mercati emergenti e energia rinnovabile.</p>
                            </div>
                            
                            <div class="bg-secondary rounded-lg p-4" data-mock="true">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="px-2 py-1 bg-muted text-muted-foreground text-xs rounded font-medium">Lungo Termine</span>
                                </div>
                                <p class="text-sm text-foreground">Crescita sostenuta guidata dall'innovazione tecnologica e transizione energetica.</p>
                            </div>
                            <!-- @END_MAP )) -->
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold text-foreground mb-4">Allocazione Ottimizzata</h4>
                        <div class="space-y-3">
                            <!-- @MAP: optimizedAllocation.map(item => ( -->
                            <div class="flex items-center justify-between p-3 bg-secondary rounded-lg" data-mock="true">
                                <div>
                                    <span class="font-medium text-foreground">Azioni Tech</span>
                                    <p class="text-xs text-muted-foreground">Riduzione per bilanciamento</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-foreground">55%</span>
                                    <span class="text-xs text-destructive">-10%</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-secondary rounded-lg" data-mock="true">
                                <div>
                                    <span class="font-medium text-foreground">ETF Diversificati</span>
                                    <p class="text-xs text-muted-foreground">Incremento per stabilità</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-foreground">30%</span>
                                    <span class="text-xs text-success">+5%</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-secondary rounded-lg" data-mock="true">
                                <div>
                                    <span class="font-medium text-foreground">Obbligazioni</span>
                                    <p class="text-xs text-muted-foreground">Maggiore protezione</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-foreground">15%</span>
                                    <span class="text-xs text-success">+12%</span>
                                </div>
                            </div>
                            <!-- @END_MAP )) -->
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-foreground mb-4">Nuovi Strumenti Suggeriti</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- @MAP: suggestedInstruments.map(suggestion => ( -->
                        <div class="bg-secondary rounded-lg p-4" data-mock="true">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h5 class="font-medium text-foreground">iShares Core MSCI World</h5>
                                    <p class="text-sm text-muted-foreground">IWDA • IE00B4L5Y983</p>
                                </div>
                                <button class="text-primary hover:text-primary/80 text-sm font-medium">Aggiungi</button>
                            </div>
                            <p class="text-xs text-muted-foreground">ETF globale per diversificazione geografica e riduzione del rischio paese.</p>
                        </div>
                        
                        <div class="bg-secondary rounded-lg p-4" data-mock="true">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h5 class="font-medium text-foreground">Vanguard FTSE Emerging</h5>
                                    <p class="text-sm text-muted-foreground">VWO • US9229087690</p>
                                </div>
                                <button class="text-primary hover:text-primary/80 text-sm font-medium">Aggiungi</button>
                            </div>
                            <p class="text-xs text-muted-foreground">Esposizione ai mercati emergenti per crescita a lungo termine.</p>
                        </div>
                        <!-- @END_MAP )) -->
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: AIRecommendations -->

    </main>

    <!-- @COMPONENT: AddInstrumentModal -->
    <div id="addInstrumentModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card rounded-lg border border-border shadow-xl max-w-md w-full p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-foreground">Aggiungi Strumento</h3>
                    <button class="p-2 hover:bg-secondary rounded-lg transition-colors" onclick="closeModal()">
                        <i class="fas fa-times text-muted-foreground"></i>
                    </button>
                </div>

                <form class="space-y-4" data-implementation="Should validate instrument and add to portfolio">
                    <div>
                        <label class="block text-sm font-medium text-foreground mb-2">Nome, Ticker o ISIN</label>
                        <input 
                            type="text" 
                            placeholder="es. Apple, AAPL, US0378331005"
                            class="w-full px-3 py-2 border border-input rounded-lg focus:ring-2 focus:ring-ring focus:border-transparent"
                            data-implementation="Should provide real-time validation and suggestions">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-foreground mb-2">Tipo di Strumento</label>
                        <select class="w-full px-3 py-2 border border-input rounded-lg focus:ring-2 focus:ring-ring focus:border-transparent">
                            <option>Azione</option>
                            <option>ETF</option>
                            <option>Criptovaluta</option>
                            <option>Obbligazione</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-foreground mb-2">Importo Investito (€)</label>
                        <input 
                            type="number" 
                            placeholder="0.00"
                            step="0.01"
                            min="0"
                            class="w-full px-3 py-2 border border-input rounded-lg focus:ring-2 focus:ring-ring focus:border-transparent">
                    </div>

                    <div class="bg-muted rounded-lg p-3">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-check-circle text-success"></i>
                            <span class="text-sm font-medium text-foreground">Strumento Validato</span>
                        </div>
                        <p class="text-xs text-muted-foreground">Apple Inc. (AAPL) - Prezzo attuale: $178.25</p>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button 
                            type="button" 
                            onclick="closeModal()"
                            class="flex-1 px-4 py-2 border border-border rounded-lg text-foreground hover:bg-secondary transition-colors">
                            Annulla
                        </button>
                        <button 
                            type="submit"
                            class="flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                            Aggiungi
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: AddInstrumentModal -->

    <script>
        // Chart initialization
        (() => {
            const ctx = document.getElementById('allocationChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['AAPL', 'VOO', 'MSFT', 'BTC', 'GOOGL'],
                        datasets: [{
                            data: [15.2, 25.8, 12.5, 7.3, 10.2],
                            backgroundColor: [
                                'hsl(214 100% 50%)',
                                'hsl(142 71% 45%)',
                                'hsl(258 90% 60%)',
                                'hsl(45 93% 55%)',
                                'hsl(10 79% 58%)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        })();

        // Modal functions
        function openModal() {
            document.getElementById('addInstrumentModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('addInstrumentModal').classList.add('hidden');
        }

        // AI Analysis trigger
        function showAIRecommendations() {
            const aiSection = document.getElementById('aiRecommendations');
            const loadingDiv = document.getElementById('analysisLoading');
            const resultsDiv = document.getElementById('analysisResults');
            
            aiSection.style.display = 'block';
            loadingDiv.style.display = 'block';
            resultsDiv.style.display = 'none';
            
            // Simulate AI analysis
            setTimeout(() => {
                loadingDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
            }, 2000);
        }

        // Event listeners
        (() => {
            // Add instrument button
            document.querySelector('[data-event="click:openAddInstrumentModal"]')?.addEventListener('click', openModal);
            
            // AI Analysis button
            document.querySelector('[data-event="click:triggerAIAnalysis"]')?.addEventListener('click', showAIRecommendations);
            
            // Close modal on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });

            // Simulate real-time price updates
            setInterval(() => {
                const priceElements = document.querySelectorAll('.price-update');
                priceElements.forEach(el => {
                    el.classList.add('animate-pulse-slow');
                    setTimeout(() => {
                        el.classList.remove('animate-pulse-slow');
                    }, 1000);
                });
            }, 30000);
        })();

        // TODO: Implement real-time price fetching from financial APIs
        // TODO: Implement AI portfolio analysis using OpenAI or similar free service
        // TODO: Implement form validation and instrument search
        // TODO: Implement portfolio data persistence
        // TODO: Implement responsive chart updates
    </script>
</body>
</html>